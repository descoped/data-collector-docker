FROM statisticsnorway/alpine-jdk13-buildtools:latest as build

#
# Build DC Backend
#


#
# Build DC image
#
FROM alpine:latest

RUN apk add --no-cache bash su-exec curl openssl

ENV DC_HOME=/opt/dc

ENV JAVA_OPTS=
ENV PROXY_HTTP_HOST=
ENV PROXY_HTTP_PORT=
ENV PROXY_HTTPS_HOST=
ENV PROXY_HTTPS_PORT=
ENV ENABLE_JMX_REMOTE_DEBUGGING=true

#ENV UID=dc
#ENV GID=dc

#RUN useradd -r --create-home --home-dir $DC_HOME --groups $GID --shell /bin/bash $UID

#
# Resources from build image
#
COPY --from=build /opt/jdk /opt/jdk/
COPY target/dependency $DC_HOME/lib/
COPY target/data-collector-*.jar $DC_HOME/lib/
COPY target/classes/logback-stash.xml $DC_HOME/

ADD docker/start-collector.sh /run.sh
RUN chmod +x /run.sh

#COPY docker/entrypoint.bash /entrypoint.sh
#RUN chmod +x /entrypoint.sh

ENV PATH=/opt/jdk/bin:$PATH
ENV JAVA_HOME=/opt/jdk

WORKDIR $DC_HOME

VOLUME ["/conf", "/certs"]

EXPOSE 9990
EXPOSE 9992

#ENTRYPOINT ["/entrypoint.sh"]
CMD ["/run.sh"]
